<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bazar Marocain</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body { padding-top: 140px; padding-bottom: 80px; background: #f7f7f7; font-family: "Segoe UI", sans-serif; }
header, footer { position: fixed; width: 100%; left: 0; z-index: 1000; text-align: center; color: white; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
header { top: 0; padding: 20px 0; background: linear-gradient(90deg, #006400, #ff0000); font-size: 28px; }
footer { bottom: 0; padding: 15px 0; background: linear-gradient(90deg, #ff0000, #006400); font-size: 18px; }
.marquee-container { background: #ffd700; color: #006400; padding: 8px 0; position: fixed; top: 80px; width: 100%; z-index: 1001; font-weight: bold; }
.product-card { cursor: pointer; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.2); background: #fff; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
.product-card.show { opacity: 1; transform: translateY(0); }
.product-card:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
.overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; opacity:0; pointer-events:none; transition: opacity 0.3s; z-index:2000; }
.overlay.show { opacity:1; pointer-events:auto; }
.overlay-content { background:#fff; padding:25px; border-radius:15px; max-width:500px; width:90%; position: relative; animation: fadeIn 0.4s; text-align:center; }
@keyframes fadeIn { from {opacity:0; transform: translateY(-20px);} to {opacity:1; transform: translateY(0);} }
.overlay img { width:100%; border-radius:10px; margin-bottom:15px; }
.overlay-close { position:absolute; top:10px; right:15px; cursor:pointer; color:red; font-size:28px; }
.quantity-container { display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:15px; }
.quantity-container button { width:35px; height:35px; border:none; background:#006400; color:white; font-size:18px; border-radius:5px; cursor:pointer; }
.quantity-container span { min-width:30px; display:inline-block; text-align:center; font-weight:bold; font-size:18px; }
.btn-add { transition: all 0.3s; }
.btn-add:hover { transform: scale(1.05); }
#cartIcon { position: fixed; bottom: 20px; right: 20px; background: #006400; color: white; width:60px; height:60px; border-radius:50%; display:flex; justify-content:center; align-items:center; cursor:pointer; z-index: 1500; box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 24px; }
#cartCount { position: absolute; top: 5px; right: 5px; background: red; width:18px; height:18px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:12px; }
</style>
</head>
<body>

<header>Bazar Marocain</header>
<div class="marquee-container">
  <marquee behavior="scroll" direction="left">ðŸŒŸ Promotions du jour: Tapis -10%, Lampes -15%, Ã‰pices -5% ðŸŒŸ</marquee>
</div>

<div class="container my-4">
  <div class="row g-3" id="products-container"></div>
</div>

<footer>&copy; 2025 Bazar Marocain</footer>

<!-- Overlay Produit -->
<div class="overlay" id="productOverlay">
  <div class="overlay-content">
    <span class="overlay-close" id="overlayClose">&times;</span>
    <img id="overlayImage" src="" alt="Produit">
    <h3 id="overlayTitle"></h3>
    <p id="overlayDescription"></p>
    <p id="overlayPrice" style="font-weight:bold;"></p>
    <div class="quantity-container">
      <button id="decreaseQty">-</button>
      <span id="quantity">1</span>
      <button id="increaseQty">+</button>
    </div>
    <button class="btn btn-success w-100 btn-add" id="addToCartBtn"><i class="fa-solid fa-cart-plus"></i> Ajouter au panier</button>
  </div>
</div>

<!-- Panier flottant -->
<div id="cartIcon">
  <i class="fa-solid fa-shopping-cart"></i>
  <div id="cartCount">0</div>
</div>

<script>
const products = [
  { id:1, title:"Tapis Marocain", description:"Beau tapis fait Ã  la main.", price:250, image:"https://via.placeholder.com/300x200?text=Tapis" },
  { id:2, title:"Lampes Artisanales", description:"Lampes traditionnelles en mÃ©tal.", price:150, image:"https://via.placeholder.com/300x200?text=Lampes" },
  { id:3, title:"CÃ©ramiques", description:"Vaisselle et poteries marocaines.", price:80, image:"https://via.placeholder.com/300x200?text=Ceramiques" },
  { id:4, title:"Ã‰pices", description:"MÃ©lange d'Ã©pices marocaines.", price:50, image:"https://via.placeholder.com/300x200?text=Epices" },
];

let cart = [];
const container = document.getElementById("products-container");

products.forEach((product,i)=>{
  const div = document.createElement("div");
  div.classList.add("col-6","col-md-3");
  div.innerHTML = `
    <div class="card product-card" data-id="${product.id}">
      <img src="${product.image}" class="card-img-top" alt="${product.title}">
      <div class="card-body text-center">
        <h5 class="card-title">${product.title}</h5>
        <p class="card-text">${product.price} DH</p>
      </div>
    </div>
  `;
  container.appendChild(div);
  setTimeout(()=>{div.querySelector(".product-card").classList.add("show");}, i*150);
});

// Overlay
const overlay = document.getElementById("productOverlay");
const overlayImage = document.getElementById("overlayImage");
const overlayTitle = document.getElementById("overlayTitle");
const overlayDescription = document.getElementById("overlayDescription");
const overlayPrice = document.getElementById("overlayPrice");
const overlayClose = document.getElementById("overlayClose");
const quantitySpan = document.getElementById("quantity");
let selectedProduct = null;
let qty = 1;

document.querySelectorAll(".product-card").forEach(card=>{
  card.addEventListener("click", ()=>{
    selectedProduct = products.find(p=>p.id==card.dataset.id);
    overlayImage.src = selectedProduct.image;
    overlayTitle.textContent = selectedProduct.title;
    overlayDescription.textContent = selectedProduct.description;
    overlayPrice.textContent = selectedProduct.price + " DH";
    qty = 1;
    quantitySpan.textContent = qty;
    overlay.classList.add("show");
  });
});
overlayClose.addEventListener("click", ()=> overlay.classList.remove("show"));
document.getElementById("increaseQty").addEventListener("click", ()=> { qty++; quantitySpan.textContent = qty; });
document.getElementById("decreaseQty").addEventListener("click", ()=> { if(qty>1){ qty--; quantitySpan.textContent = qty; }});

const cartCount = document.getElementById("cartCount");
const addToCartBtn = document.getElementById("addToCartBtn");
addToCartBtn.addEventListener("click", ()=>{
  const existing = cart.find(p=>p.id===selectedProduct.id);
  if(existing){ existing.quantity += qty; } 
  else { cart.push({ ...selectedProduct, quantity: qty }); }
  updateCartCount();
  Swal.fire({icon:'success', title:'AjoutÃ©!', text:`${selectedProduct.title} (${qty}) ajoutÃ© au panier.`});
  overlay.classList.remove("show");
});

const cartIcon = document.getElementById("cartIcon");
cartIcon.addEventListener("click", showCartAlert);

function updateCartCount(){
  cartCount.textContent = cart.reduce((sum,item)=>sum+item.quantity,0);
}

function showCartAlert() {
  if(cart.length===0){ Swal.fire('Panier vide','Votre panier est vide.','info'); return; }

  function buildCartHtml(){
    let html='<ul style="list-style:none;padding:0;">';
    cart.forEach((item,index)=>{
      html+=`<li style="margin-bottom:10px;border-bottom:1px solid #ddd;padding-bottom:5px;">
        <strong>${item.title}</strong><br>
        Prix: ${item.price} DH | QuantitÃ©: 
        <button onclick="changeQty(${index},-1)" style="width:25px;height:25px;background:#006400;color:#fff;border:none;">-</button>
        ${item.quantity}
        <button onclick="changeQty(${index},1)" style="width:25px;height:25px;background:#006400;color:#fff;border:none;">+</button>
        | Total: <span id="itemTotal${index}">${item.price*item.quantity}</span> DH
        <br><button class="swal2-confirm swal2-styled" style="margin-top:5px;background:#dc3545;" onclick="removeFromCart(${index})">Supprimer</button>
      </li>`;
    });
    html+='</ul>';
    html+=`<strong>Total gÃ©nÃ©ral: <span id="cartTotal">${cart.reduce((sum,item)=>sum+item.price*item.quantity,0)}</span> DH</strong>`;
    return html;
  }

  window.changeQty = function(index,delta){
    cart[index].quantity += delta;
    if(cart[index].quantity<1) cart[index].quantity=1;
    document.getElementById(`itemTotal${index}`).textContent = cart[index].price*cart[index].quantity;
    document.getElementById('cartTotal').textContent = cart.reduce((sum,item)=>sum+item.price*item.quantity,0);
    updateCartCount(); // <- correction
    showCartAlert(); // rafraÃ®chit l'alerte avec nouvelles quantitÃ©s
  }

  window.removeFromCart = function(index){
    cart.splice(index,1);
    updateCartCount();
    showCartAlert();
  }

  Swal.fire({
    title:'Votre Panier',
    html: buildCartHtml(),
    icon:'info',
    showCancelButton:true,
    confirmButtonText:'Commander',
    cancelButtonText:'Fermer',
    allowOutsideClick:false
  }).then((result)=>{
    if(result.isConfirmed){
      Swal.fire({
        title:'Vos informations',
        html:
          `<label style="color:#000;font-weight:bold;text-align:left;width:100%;">Nom complet</label>`+
          `<input type="text" id="clientName" class="swal2-input" placeholder="Ex: Ahmed" style="color:#000;background:#fff;border:1px solid #006400;">`+
          `<label style="color:#000;font-weight:bold;text-align:left;width:100%;">Adresse</label>`+
          `<input type="text" id="clientAddress" class="swal2-input" placeholder="Ex: Marrakech" style="color:#000;background:#fff;border:1px solid #006400;">`+
          `<label style="color:#000;font-weight:bold;text-align:left;width:100%;">Commentaire (facultatif)</label>`+
          `<textarea id="clientComment" class="swal2-textarea" placeholder="Ex: Livrer aprÃ¨s 18h" style="color:#000;background:#fff;border:1px solid #006400;"></textarea>`,
        focusConfirm:false,
        showCancelButton:true,
        preConfirm: ()=>{
            const name=document.getElementById("clientName").value.trim();
            const address=document.getElementById("clientAddress").value.trim();
            const comment=document.getElementById("clientComment").value.trim();
            if(!name||!address){ Swal.showValidationMessage('Veuillez remplir nom et adresse'); return false; }
            return {name,address,comment};
        }
      }).then(info=>{
        if(info.isConfirmed){
          const client=info.value;
          let total=cart.reduce((sum,item)=>sum+item.price*item.quantity,0);
          let whatsappMsg=`Bonjour,%0AJe souhaite commander:%0A`;
          cart.forEach(item=>{
            whatsappMsg+=`- ${item.title} | Prix: ${item.price} DH | QuantitÃ©: ${item.quantity} | Total: ${item.price*item.quantity} DH%0A`;
          });
          whatsappMsg+=`%0ATotal gÃ©nÃ©ral: ${total} DH`;
          whatsappMsg+=`%0A%0ANom: ${client.name}%0AAdresse: ${client.address}`;
          if(client.comment) whatsappMsg+=`%0ACommentaire: ${client.comment}`;
          window.open(`https://wa.me/212608975435?text=${whatsappMsg}`,'_blank');
          Swal.fire('Merci!','Votre commande a Ã©tÃ© envoyÃ©e via WhatsApp.','success');
          cart=[];
          updateCartCount();
        }
      });
    }
  });
}
</script>
</body>
</html>
